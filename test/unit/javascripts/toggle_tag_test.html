<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Item Browser Test</title>
  <script src="../../../public/javascripts/prototype.js" type="text/javascript"></script>
  <script src="../../../public/javascripts/effects.js" type="text/javascript"></script>
  <script src="../../../public/javascripts/unittest.js" type="text/javascript"></script>
  <script src="../../../public/javascripts/application.js" type="text/javascript"></script>
  <script src="../../../public/javascripts/tagging.js" type="text/javascript"></script>
  <!-- other JavaScript includes -->
  <link rel="stylesheet" href="test.css" type="text/css" />
  <script type="text/javascript" charset="utf-8">
	var url;
	var parameters;
  	function sendTagRequest(request_url, request_parameters) {
		url = request_url;
		parameters = request_parameters;
	}
	function assertParameters(test, type, id, tag, strength) {
		test.assertEqual(type, parameters['tagging[taggable_type]']);
		test.assertEqual(id, parameters['tagging[taggable_id]']);
		test.assertEqual(tag, parameters['tagging[tag]']);
		
		if (strength) {
			test.assertEqual(strength, parameters['tagging[strength]']);			
		}
	}
  </script>
</head>
<body>

<!-- Log output -->
<div id="testlog"> </div>

<h2>Test Elements</h2>
<!-- here go any elements you do the testing on -->
<span id="tag_control_for_tag_on_feed_item_1" class="tag_control untagged">tag</span>

<!-- Tests -->
<script type="text/javascript" language="javascript">
var control = 'tag_control_for_tag_on_feed_item_1';

// <![CDATA[
 // new Test.Unit.Runner instance
new Test.Unit.Runner({
	// optional setup function, run before each individual test case
	setup: function() { with(this) { 
		url = parameters = null;
		$(control).classNames().set('tag_control');
	}},
	// optional teardown function, run after each individual test case
	teardown: function() { with(this) { }},

	testToggleFromUntaggedToUserTagged: function() { with(this) {
		$(control).addClassName('untagged')
		toggle_tag('feed_item_1', 'tag');
		assert($(control).hasClassName('user_tagging'), "user_tagging was not added");
		assert($(control).hasClassName('tagged'));
		assert(!$(control).hasClassName('untagged'));

		assertEqual('/taggings/create', url);
		assertParameters(this, "FeedItem", "1", "tag", "1");
	}},
	
	testToggleFromTaggedToUserUntaggedResultsInDestroy: function() { with(this) {
	  	$(control).classNames().set('tag_control tagged user_tagging');;
		toggle_tag('feed_item_1', 'tag');
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('untagged'));
		assert(!$(control).hasClassName('tagged'));
		
		assertEqual('/taggings/destroy', url);
		assertParameters(this, "FeedItem", "1", "tag");
	}},
	
	testCycleUserTagStates: function() { with(this) {
		$(control).addClassName('untagged')
	  	toggle_tag('feed_item_1', 'tag');
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('tagged'));
		assert(!$(control).hasClassName('untagged'));

		assertEqual('/taggings/create', url);
		assertParameters(this, "FeedItem", "1", "tag", "1");
		
		toggle_tag('feed_item_1', 'tag');
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('untagged'));
		assert(!$(control).hasClassName('tagged'));
		
		assertEqual('/taggings/destroy', url);
		assertParameters(this, "FeedItem", "1", "tag");
	}},
	
	testToggleFromNegativeTaggingWithNoClassifierTaggingToPositiveTagging: function() { with(this) {
	  	$(control).addClassName('user_tagging negative_tagging');
		toggle_tag('feed_item_1', 'tag');
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('tagged'));
		assertEqual('/taggings/create', url);
		assertParameters(this, 'FeedItem', '1', 'tag', '1');
	}},
	
	testCycleFromNegativeTaggingWithNoClassifierTagging: function() { with(this) {
		// Negative -> tagged
	  	$(control).addClassName('user_tagging negative_tagging');
		toggle_tag('feed_item_1', 'tag');
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('tagged'));
		assertEqual('/taggings/create', url);
		assertParameters(this, 'FeedItem', '1', 'tag', '1');
		
		// tagged -> untagged
		toggle_tag('feed_item_1', 'tag');
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('untagged'));
		assert(!$(control).hasClassName('tagged'));
		assertEqual('/taggings/destroy', url);
		assertParameters(this, "FeedItem", "1", "tag");
		
		// untagged -> tagged
		$(control).addClassName('untagged')
		toggle_tag('feed_item_1', 'tag');
		assert($(control).hasClassName('user_tagging'), "user_tagging was not added");
		assert($(control).hasClassName('tagged'));
		assert(!$(control).hasClassName('untagged'));
		assertEqual('/taggings/create', url);
		assertParameters(this, "FeedItem", "1", "tag", "1");
	}},
	
	testToggleFromClassifierTagToNegativeTag: function() { with(this) {
	    $(control).addClassName('tagged');
		$(control).addClassName('bayes_classifier_tagging');
		toggle_tag('feed_item_1', 'tag');
		
		assert(!$(control).hasClassName('tagged'));
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('negative_tagging'));
		assert($(control).hasClassName('bayes_classifier_tagging'));
		
		assertEqual('/taggings/create', url);
		assertParameters(this, "FeedItem", "1", "tag", "0");
	}},
	
	testToggleFromNegativeUserTagToPositiveTag: function() { with(this) {
	    $(control).addClassName('negative_tagging');
		$(control).addClassName('user_tagging');
		$(control).addClassName('bayes_classifier_tagging');
	    toggle_tag('feed_item_1', 'tag');
		
		assert(!$(control).hasClassName('negative_tagging'));
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('tagged'));
		assert($(control).hasClassName('bayes_classifier_tagging'));
		
		assertEqual('/taggings/create', url);
		assertParameters(this, "FeedItem", "1", "tag", "1");
	}},
	
	testToggleFromPositiveUserTagToClassifier: function() { with(this) {
	    $(control).addClassName('tagged');
		$(control).addClassName('user_tagging');
		$(control).addClassName('bayes_classifier_tagging');
	    toggle_tag('feed_item_1', 'tag');
		
		assert(!$(control).hasClassName('negative_tagging'));
		assert(!$(control).hasClassName('user_tagging'), "f");
		assert($(control).hasClassName('tagged'));
		assert($(control).hasClassName('bayes_classifier_tagging'));
		
		assertEqual('/taggings/destroy', url);
		assertParameters(this, "FeedItem", "1", "tag");
	}},
	
	testCycleClassifierStatesassertEquals: function() { with(this) {
		// Classifier -> Negative User
	    $(control).addClassName('tagged');
		$(control).addClassName('bayes_classifier_tagging');
		$(control).removeClassName('user_tagging');
		toggle_tag('feed_item_1', 'tag');
		
		assert(!$(control).hasClassName('tagged'));
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('negative_tagging'));
		assert($(control).hasClassName('bayes_classifier_tagging'));
		
		assertEqual('/taggings/create', url);
		assertParameters(this, "FeedItem", "1", "tag", "0");
		
		// Negative User -> Positive User
	    toggle_tag('feed_item_1', 'tag')
		
		assert(!$(control).hasClassName('negative_tagging'));
		assert($(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('tagged'));
		assert($(control).hasClassName('bayes_classifier_tagging'));
		
		assertEqual('/taggings/create', url);
		assertParameters(this, "FeedItem", "1", "tag", "1");
		
		// Positive User -> Classifier
	    toggle_tag('feed_item_1', 'tag')
		
		assert(!$(control).hasClassName('negative_tagging'));
		assert(!$(control).hasClassName('user_tagging'));
		assert($(control).hasClassName('tagged'));
		assert($(control).hasClassName('bayes_classifier_tagging'));
		
		assertEqual('/taggings/destroy', url);
		assertParameters(this, "FeedItem", "1", "tag");
	}}
});
// ]]>
</script>
</body>
</html>
