<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Item Browser Test</title>
  <script src="../../../public/javascripts/prototype.js" type="text/javascript"></script>
  <script src="../../../public/javascripts/effects.js" type="text/javascript"></script>
  <script src="../../../public/javascripts/unittest.js" type="text/javascript"></script>
  <script src="../../../public/javascripts/builder.js" type="text/javascript"></script>
  <script src="../../../public/javascripts/application.js" type="text/javascript"></script>
  <script src="../../../public/javascripts/tagging.js" type="text/javascript"></script>
  <!-- other JavaScript includes -->
  <link rel="stylesheet" href="test.css" type="text/css" />
  <script type="text/javascript" charset="utf-8">
	real_toggle_tag = toggle_tag;
	var tt_args;
  	function fake_toggle_tag() {
		tt_args = $A(arguments);
	}
	function sendTagRequest(request_url, request_parameters) {
		url = request_url;
		parameters = request_parameters;
	}
  </script>
</head>
<body>

<!-- Log output -->
<div id="testlog"> </div>

<h2>Test Elements</h2>
<!-- here go any elements you do the testing on -->
<div id ="tag_controls_for_feed_item_1"></div>

<!-- Tests -->
<script type="text/javascript" language="javascript">
var tag_list = $('tag_controls_for_feed_item_1');
// <![CDATA[
 // new Test.Unit.Runner instance
new Test.Unit.Runner({
	// optional setup function, run before each individual test case
	setup: function() { with(this) { 
		url = parameters = null;
		tag_list.update('');
		tt_args = null;
		toggle_tag = real_toggle_tag;
	}},
	// optional teardown function, run after each individual test case
	teardown: function() { with(this) { }},
	
	testEmptyTagDoesNothing: function() { with(this) {
	    add_tag_control('feed_item_1', '');
		assertEqual('', tag_list.innerHTML);
	}},
	
	testAddTagToEmptyList: function() { with(this) {
	    add_tag_control('feed_item_1', 'tag1');
		assertEqual(1, $$('#tag_controls_for_feed_item_1 span.tag_control').size());
		assert($('tag_control_for_tag1_on_feed_item_1'));
		assertElementMatches($('tag_control_for_tag1_on_feed_item_1'), 'span.user_tagging.tagged');
		
		toggle_tag = fake_toggle_tag;
		$('tag_control_for_tag1_on_feed_item_1').onclick();
		assertEnumEqual(['feed_item_1', 'tag1'], tt_args);
	}},
	
	testAddTagThatExistsDoesntAddNewElement: function() { with(this) {
	  	tag_list.update('<span class="tag_control" id="tag_control_for_tag_on_feed_item_1">tag</span>');
	  	add_tag_control('feed_item_1', 'tag');
		assertEqual(1, $$('#tag_controls_for_feed_item_1 span.tag_control').size());
	}},
	
	testAddNewTagToEndOfList: function() { with(this) {
	    tag_list.update('<span class="tag_control" id="tag_control_for_tag_on_feed_item_1">tag</span>');
		add_tag_control('feed_item_1', 'newtag');
		assertEqual(2, $$('#tag_controls_for_feed_item_1 span.tag_control').size());
		assertEqual(1, $$('#tag_controls_for_feed_item_1 span.tag_separator').size());
		assertElementMatches($('tag_control_for_newtag_on_feed_item_1'), 'span.user_tagging.tagged');
		assertEqual('newtag',  $('tag_control_for_newtag_on_feed_item_1').innerHTML);
		
		toggle_tag = fake_toggle_tag;
		$('tag_control_for_newtag_on_feed_item_1').onclick();
		assertEnumEqual(['feed_item_1', 'newtag'], tt_args);
	}}
});
// ]]>
</script>
</body>
</html>
