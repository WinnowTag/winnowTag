load File.join(RAILS_ROOT, 'test', 'selenium_helper.rb')

setup :fixtures => [:users, :view_tag_states]

Tag.delete_all
tag = Tag.create! valid_tag_attributes(:user_id => User.find_by_login("aaron").id, :public => true)
TagSubscription.create! :tag_id => tag.id, :user_id => User.find_by_login("quentin").id

login
open "/tags"
assert_not_attribute "exclude_tag_#{tag.id}", "class", "regexp:selected"
click "exclude_tag_#{tag.id}"
assert_attribute "exclude_tag_#{tag.id}", "class", "regexp:selected"
refresh_and_wait
assert_attribute "exclude_tag_#{tag.id}", "class", "regexp:selected"
click "exclude_tag_#{tag.id}"
assert_not_attribute "exclude_tag_#{tag.id}", "class", "regexp:selected"
refresh_and_wait
assert_not_attribute "exclude_tag_#{tag.id}", "class", "regexp:selected"