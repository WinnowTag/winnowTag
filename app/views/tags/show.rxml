xml.instruct!

xml.feed "xmlns" => "http://www.w3.org/2005/Atom" do

  xml.title   @tag.name
  xml.link    "rel" => "self", "href" => public_tag_url(@tag.user, @tag)
  xml.id      public_tag_url(@tag.user, @tag)
  xml.updated @tag.feed_items.first.time.strftime("%Y-%m-%dT%H:%M:%SZ") if @tag.feed_items.any?
  

  @tag.feed_items.find(:all, :include => [:feed, :feed_item_content], :order => "feed_items.time DESC", :limit => 50).each do |feed_item|
    xml.entry do
      xml.title feed_item.content.title
      xml.author  do
        xml.name feed_item.feed.title
        xml.uri  feed_item.feed.link
      end
      xml.link    "href" => feed_item.link, "rel" => "alternate"
      xml.id      feed_item.unique_id
      xml.updated feed_item.time.strftime("%Y-%m-%dT%H:%M:%SZ")
      if feed_item.content.encoded_content
        xml.content "type" => "html" do
          xml.text! %Q(<strong>Sourced from: <a href="#{feed_item.feed.link}">#{feed_item.feed_title}</a></strong><br/><br/>)
          xml.text! feed_item.content.encoded_content
        end
      end
    end
  end
end
